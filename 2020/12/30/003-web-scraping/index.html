<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Web Scraping with Python Using MyAnimeList as An Example | A Blog From Nowhere</title><meta name="author" content="iasnobmatsu"><meta name="copyright" content="{&quot;start_year&quot;:2022,&quot;end_year&quot;:2022}"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Using BeautifulSoup and pandas to scrape and clean web data.">
<meta property="og:type" content="article">
<meta property="og:title" content="Web Scraping with Python Using MyAnimeList as An Example">
<meta property="og:url" content="http://iasnobmatsu.github.io/2020/12/30/003-web-scraping/index.html">
<meta property="og:site_name" content="A Blog From Nowhere">
<meta property="og:description" content="Using BeautifulSoup and pandas to scrape and clean web data.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://iasnobmatsu.github.io/img/d17.jpg">
<meta property="article:published_time" content="2020-12-30T05:00:00.000Z">
<meta property="article:modified_time" content="2020-12-30T05:00:00.000Z">
<meta property="article:author" content="iasnobmatsu">
<meta property="article:tag" content="web scraping">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://iasnobmatsu.github.io/img/d17.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://iasnobmatsu.github.io/2020/12/30/003-web-scraping/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Web Scraping with Python Using MyAnimeList as An Example',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-12-30 05:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">A Blog From Nowhere</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Web Scraping with Python Using MyAnimeList as An Example</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2020-12-30T05:00:00.000Z" title="Created 2020-12-30 05:00:00">2020-12-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-12-30T05:00:00.000Z" title="Updated 2020-12-30 05:00:00">2020-12-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/projects/">projects</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">1.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>11min</span></span></div></div></div><article class="post-content" id="article-container"><p>Disclaimer: The following code for scraping MAL was written on Dec 30th, 2020. MAL data structure may have changed after that.</p>
<!-- To downlaod the ipynb (python jupyter notebook) script I wrote for this post, please click [here](/html_assets/MALscrape/MALscrapper.ipynb).

To download the MAL top 3000 anime list csv file (collected Dec 29, 2020), please click [here](/html_assets/MALscrape/MALtop3000.csv).

To download my own MAL anime list csv file (collected Dec 30, 2020), please click [here](/html_assets/MALscrape/iasnobmatsuMAL.csv). -->
<h3 id="Scraping-Static-HTML-Using-MAL-Top-Animes-as-An-Example"><a href="#Scraping-Static-HTML-Using-MAL-Top-Animes-as-An-Example" class="headerlink" title="Scraping Static HTML: Using MAL Top Animes as An Example"></a>Scraping Static HTML: Using MAL Top Animes as An Example</h3><h4 id="Import-libraries"><a href="#Import-libraries" class="headerlink" title="Import libraries"></a>Import libraries</h4><ul>
<li>BeautifulSoup: for scraping</li>
<li>requests: request html and parse</li>
<li>re: regular expression for string manipulation</li>
<li>pandas: convert data scraped into csv files</li>
</ul>
<span id="more"></span>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup </span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Helper-Function-to-Parse-One-Anime-Row"><a href="#Helper-Function-to-Parse-One-Anime-Row" class="headerlink" title="Helper Function to Parse One Anime Row"></a>Helper Function to Parse One Anime Row</h4><p><img src="!--swig￼12-->/images/MALscrape/static.png" alt=""></p>
<p>Looking at the html of <a target="_blank" rel="noopener" href="https://myanimelist.net/topanime.php">https://myanimelist.net/topanime.php</a> (using chrome, right click and select inspect, navigate to the element section, and you will see the HTML), each anime is a tr (table row) of the table. Within each row, name of anime is wrapped in class anime_ranking_h3, related information in class information, and score in class score. These can be scraped with beautifulsoup rather simply using the select() function. Then the text can be cleaned.</p>
<p>We can further get a show’s start year and end year from the related information section. Here I used regular expression to get 4 digits of year to match start and end years.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">getOneRow</span>(<span class="params">targetrow</span>):</span><br><span class="line">    animeTitle=targetrow.select(<span class="string">"h3.anime_ranking_h3"</span>)[<span class="number">0</span>].text</span><br><span class="line">    animeInformation=targetrow.select(<span class="string">"div.information"</span>)[<span class="number">0</span>].text.replace(<span class="string">"\n"</span>,<span class="string">"|"</span>).replace(<span class="string">"  "</span>,<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">    animeScore=targetrow.select(<span class="string">"td.score"</span>)[<span class="number">0</span>].text.replace(<span class="string">"\n"</span>, <span class="string">""</span>)</span><br><span class="line">    <span class="comment"># split by |</span></span><br><span class="line">    year=animeInformation.split(<span class="string">"|"</span>) </span><br><span class="line">    <span class="comment"># get all years in the second section from above</span></span><br><span class="line">    years=re.findall(<span class="string">'[0-9]+'</span>, year[<span class="number">2</span>])</span><br><span class="line">    start=<span class="string">"NA"</span></span><br><span class="line">    end=<span class="string">"NA"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(year)&gt;<span class="number">0</span>:</span><br><span class="line">        start=years[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(years)&gt;<span class="number">1</span>:</span><br><span class="line">            end=years[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> animeTitle, animeInformation,animeScore, start, end</span><br><span class="line"></span><br><span class="line"><span class="comment"># tablerow[0]</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Function-to-Get-a-Specified-Number-of-Anime-on-The-Top-Anime-List"><a href="#Function-to-Get-a-Specified-Number-of-Anime-on-The-Top-Anime-List" class="headerlink" title="Function to Get a Specified Number of Anime on The Top Anime List"></a>Function to Get a Specified Number of Anime on The Top Anime List</h4><p>Pass in the url into requests.get() function to get the entire page, then make a soup out of it with BeautifulSoup. With the soup ready, we could find the table corresponding to the top anime list and find all its rows. For each row, get desired data with the getOneRow() helper function. Because each page of the top anime list only has 50 animes, if requesting more than 50 anime, make sure to get a loop to scrape pages after the first one.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">getTopAnime</span>(<span class="params">limit</span>):</span><br><span class="line">    <span class="comment"># I find using a dict to store data is the easiest, and it's easy to convert to JSON or csv</span></span><br><span class="line">    topanimedict=[] </span><br><span class="line"></span><br><span class="line">    <span class="comment">#url</span></span><br><span class="line">    url = <span class="string">"https://myanimelist.net/topanime.php"</span> </span><br><span class="line">    <span class="comment">#make soup of html</span></span><br><span class="line">    soup = BeautifulSoup(requests.get(url).text, <span class="string">'lxml'</span>) </span><br><span class="line">    <span class="comment">#get table corresponding to the top anime table.</span></span><br><span class="line">    toptable = soup.select(<span class="string">"table"</span>)[<span class="number">0</span>] </span><br><span class="line">    <span class="comment">#get all rows in the table</span></span><br><span class="line">    tablerow=toptable.select(<span class="string">"tr.ranking-list"</span>) </span><br><span class="line">     <span class="comment">#get data for each row</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> tablerow:</span><br><span class="line">        anime, info, score, st, ed=getOneRow(row)</span><br><span class="line">        tempdict={<span class="string">"anime"</span>: anime,<span class="string">"start"</span>: st, <span class="string">"end"</span>:ed,  <span class="string">"score"</span>: score, <span class="string">"information"</span>: info}</span><br><span class="line">        topanimedict.append(tempdict)</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># get page 2, 3, 4 etc after the first one</span></span><br><span class="line">    <span class="keyword">if</span> limit&gt;<span class="number">50</span>: </span><br><span class="line">        ind=limit//<span class="number">50</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">1</span>,ind):</span><br><span class="line">            url = <span class="string">"https://myanimelist.net/topanime.php?limit="</span>+<span class="built_in">str</span>(<span class="number">50</span>*i)</span><br><span class="line">            <span class="built_in">print</span>(url)</span><br><span class="line">            soup = BeautifulSoup(requests.get(url).text, <span class="string">'lxml'</span>)</span><br><span class="line">            toptable = soup.select(<span class="string">"table"</span>)[<span class="number">0</span>]</span><br><span class="line">            tablerow=toptable.select(<span class="string">"tr.ranking-list"</span>)</span><br><span class="line">            <span class="keyword">for</span> row <span class="keyword">in</span> tablerow:</span><br><span class="line">                anime, info, score, st, ed=getOneRow(row)</span><br><span class="line">                tempdict={<span class="string">"anime"</span>: anime,<span class="string">"start"</span>: st, <span class="string">"end"</span>:ed,  <span class="string">"score"</span>: score, <span class="string">"information"</span>: info}</span><br><span class="line">                topanimedict.append(tempdict)</span><br><span class="line">    </span><br><span class="line">    topanimedf=pd.DataFrame.from_dict(topanimedict)</span><br><span class="line">    <span class="keyword">return</span> topanimedf</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Convert-Data"><a href="#Convert-Data" class="headerlink" title="Convert Data"></a>Convert Data</h4><p>With the help of a dictionary and the pandas library, it is really easy to convert what we scraped into a csv. This script will save the data to the same directory where the script is stored.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df=getTopAnime(<span class="number">3000</span>)</span><br><span class="line">df.to_csv(<span class="string">'MALtop3000.csv'</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>https://myanimelist.net/topanime.php?limit=50
https://myanimelist.net/topanime.php?limit=100
https://myanimelist.net/topanime.php?limit=150
https://myanimelist.net/topanime.php?limit=200
https://myanimelist.net/topanime.php?limit=250
https://myanimelist.net/topanime.php?limit=300
https://myanimelist.net/topanime.php?limit=350
https://myanimelist.net/topanime.php?limit=400
https://myanimelist.net/topanime.php?limit=450
https://myanimelist.net/topanime.php?limit=500
https://myanimelist.net/topanime.php?limit=550
https://myanimelist.net/topanime.php?limit=600
https://myanimelist.net/topanime.php?limit=650
https://myanimelist.net/topanime.php?limit=700
https://myanimelist.net/topanime.php?limit=750
https://myanimelist.net/topanime.php?limit=800
https://myanimelist.net/topanime.php?limit=850
https://myanimelist.net/topanime.php?limit=900
https://myanimelist.net/topanime.php?limit=950
https://myanimelist.net/topanime.php?limit=1000
https://myanimelist.net/topanime.php?limit=1050
https://myanimelist.net/topanime.php?limit=1100
https://myanimelist.net/topanime.php?limit=1150
https://myanimelist.net/topanime.php?limit=1200
https://myanimelist.net/topanime.php?limit=1250
https://myanimelist.net/topanime.php?limit=1300
https://myanimelist.net/topanime.php?limit=1350
https://myanimelist.net/topanime.php?limit=1400
https://myanimelist.net/topanime.php?limit=1450
https://myanimelist.net/topanime.php?limit=1500
https://myanimelist.net/topanime.php?limit=1550
https://myanimelist.net/topanime.php?limit=1600
https://myanimelist.net/topanime.php?limit=1650
https://myanimelist.net/topanime.php?limit=1700
https://myanimelist.net/topanime.php?limit=1750
https://myanimelist.net/topanime.php?limit=1800
https://myanimelist.net/topanime.php?limit=1850
https://myanimelist.net/topanime.php?limit=1900
https://myanimelist.net/topanime.php?limit=1950
https://myanimelist.net/topanime.php?limit=2000
https://myanimelist.net/topanime.php?limit=2050
https://myanimelist.net/topanime.php?limit=2100
https://myanimelist.net/topanime.php?limit=2150
https://myanimelist.net/topanime.php?limit=2200
https://myanimelist.net/topanime.php?limit=2250
https://myanimelist.net/topanime.php?limit=2300
https://myanimelist.net/topanime.php?limit=2350
https://myanimelist.net/topanime.php?limit=2400
https://myanimelist.net/topanime.php?limit=2450
https://myanimelist.net/topanime.php?limit=2500
https://myanimelist.net/topanime.php?limit=2550
https://myanimelist.net/topanime.php?limit=2600
https://myanimelist.net/topanime.php?limit=2650
https://myanimelist.net/topanime.php?limit=2700
https://myanimelist.net/topanime.php?limit=2750
https://myanimelist.net/topanime.php?limit=2800
https://myanimelist.net/topanime.php?limit=2850
https://myanimelist.net/topanime.php?limit=2900
https://myanimelist.net/topanime.php?limit=2950
</code></pre><p>Take a look at the scrape data file. Looked pretty neat to me. Index is the ranking-1.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.tail()</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>anime</th>
      <th>end</th>
      <th>information</th>
      <th>score</th>
      <th>start</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2995</th>
      <td>Sekirei</td>
      <td>2008</td>
      <td>|TV (12 eps)|Jul 2008 - Sep 2008|320,922 members|</td>
      <td>7.14</td>
      <td>2008</td>
    </tr>
    <tr>
      <th>2996</th>
      <td>Shin Atashin'chi</td>
      <td>2016</td>
      <td>|TV (26 eps)|Oct 2015 - Apr 2016|2,427 members|</td>
      <td>7.14</td>
      <td>2015</td>
    </tr>
    <tr>
      <th>2997</th>
      <td>Tantei Opera Milky Holmes Movie: Gyakushuu no ...</td>
      <td>2016</td>
      <td>|Movie (1 eps)|Feb 2016 - Feb 2016|3,417 members|</td>
      <td>7.14</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>2998</th>
      <td>Tenchi Muyou! Manatsu no Eve</td>
      <td>1997</td>
      <td>|Movie (1 eps)|Aug 1997 - Aug 1997|13,514 memb...</td>
      <td>7.14</td>
      <td>1997</td>
    </tr>
    <tr>
      <th>2999</th>
      <td>Tengen Toppa Gurren Lagann: Parallel Works</td>
      <td>2008</td>
      <td>|Music (8 eps)|Jun 2008 - Sep 2008|29,743 memb...</td>
      <td>7.14</td>
      <td>2008</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="Scraping-Dynamic-HTML-Using-MAL-user-list-as-An-Example"><a href="#Scraping-Dynamic-HTML-Using-MAL-user-list-as-An-Example" class="headerlink" title="Scraping Dynamic HTML: Using MAL user list as An Example"></a>Scraping Dynamic HTML: Using MAL user list as An Example</h3><p>with the code here, you will be able to scrape any user’s MAL. Here I used my own anime list as an example (<a target="_blank" rel="noopener" href="https://myanimelist.net/animelist/iasnobmatsu">https://myanimelist.net/animelist/iasnobmatsu</a>, FYI I highly highly recommend Attack on Titan, Haikyu, and Hoseki no Kuni).</p>
<p>Dynamic HTML is different from static HTML as the static HTML is rendered from HTML source file (imaging writing an html file and that is what we scrape). Dynamic HTML, on the other side, is not rendered from HTML source files but from JavaScript (Or JQuery or React, whatever framework). Dynamic HTML, unlike static, is not generate the moment a url is opened, but will need some time to render after the document is ready.</p>
<h4 id="Helper-Function-to-Get-One-Row-of-MAL-User-List"><a href="#Helper-Function-to-Get-One-Row-of-MAL-User-List" class="headerlink" title="Helper Function to Get One Row of MAL User List"></a>Helper Function to Get One Row of MAL User List</h4><p><img src="!--swig￼13-->/images/MALscrape/dynamic.png" alt=""></p>
<p>Similar to the getOneRow function(), this function parses specific data for one anime. This step is the same regardless of static or dynamic HTML.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">getOneRowMAL</span>(<span class="params">targetrow</span>):</span><br><span class="line">    animeTitle=targetrow.select(<span class="string">"td.title"</span>)[<span class="number">0</span>].select(<span class="string">"a.link.sort"</span>)[<span class="number">0</span>].text</span><br><span class="line">    animeType=targetrow.select(<span class="string">"td.type"</span>)[<span class="number">0</span>].text.strip()</span><br><span class="line">    animeScore=targetrow.select(<span class="string">"td.score"</span>)[<span class="number">0</span>].text.strip()</span><br><span class="line">    animeProgress=targetrow.select(<span class="string">"td.progress"</span>)[<span class="number">0</span>].text.replace(<span class="string">"\n"</span>, <span class="string">""</span>).replace(<span class="string">"  "</span>,<span class="string">""</span>)</span><br><span class="line">    <span class="keyword">return</span> animeTitle, animeType,animeScore, animeProgress</span><br><span class="line"></span><br><span class="line">getOneRowMAL(rows[<span class="number">27</span>])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>('Haikyuu!!', 'TV', '7', ' 25 ')
</code></pre><h4 id="Additional-Libraries-for-Dynamic-HTML"><a href="#Additional-Libraries-for-Dynamic-HTML" class="headerlink" title="Additional Libraries for Dynamic HTML"></a>Additional Libraries for Dynamic HTML</h4><p>For scraping dynamic HTML, we need selenium and time. </p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Get-Dynamic-MAL-User-List-Data"><a href="#Get-Dynamic-MAL-User-List-Data" class="headerlink" title="Get Dynamic MAL User List Data"></a>Get Dynamic MAL User List Data</h4><p>to scrape dynamic data, we need the url of the webpage. We also need to have a web browser driver. Here I use the Chrome driver (download here <a target="_blank" rel="noopener" href="https://chromedriver.chromium.org/">https://chromedriver.chromium.org/</a> or through homebrew etc). I stored it in my download folder, and I will need the path to the driver. I used Mac and Chrome driver in this case. </p>
<p>With the url of webpage and path to browser driver ready, we will use selenium to declare a driver variable, and use it instead of requests to get the url.</p>
<p>Then it is important to delay the rest of the function by some time, here I used .2 but it may differ depend on how fast a page loads on a specific device under specific internet conditions. This time allows dynamic HTML to render so we scrape the desired content instead of the intial script used to generate the HTML (which we cannot parse).<br>Then similar steps to scrape each row of data from the user anime list using BeautifulSoup.</p>
<p>When using selenium with webdriver to scrap data, the browser may pop open with the url. You should not close the window until the data is scraped. If the window is closedbefore beautifulsoup get the change to read code on the driver, it will not work.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">getMAL</span>(<span class="params">url, driverPath</span>):</span><br><span class="line">    MALdict=[]</span><br><span class="line">    <span class="comment"># use selenium to simulate driver</span></span><br><span class="line">    driver = webdriver.Chrome(driverPath)</span><br><span class="line">    driver.get(url) <span class="comment"># get page</span></span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">0.2</span>) <span class="comment"># may need to change</span></span><br><span class="line">    <span class="comment"># similar to static, get soup and parse</span></span><br><span class="line">    soup=BeautifulSoup(driver.page_source, <span class="string">'lxml'</span>)</span><br><span class="line">    toptable = soup.select(<span class="string">"table"</span>)[<span class="number">0</span>]</span><br><span class="line">    rows=toptable.select(<span class="string">"tbody.list-item"</span>)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> rows:</span><br><span class="line">        ti,ty,sc,pr=getOneRowMAL(row)</span><br><span class="line">        MALdict.append({<span class="string">"anime"</span>:ti,<span class="string">"type"</span>:ty, <span class="string">"score"</span>:sc,<span class="string">"progress"</span>:pr})</span><br><span class="line">    <span class="keyword">return</span> pd.DataFrame.from_dict(MALdict)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="Convert-Data-1"><a href="#Convert-Data-1" class="headerlink" title="Convert Data"></a>Convert Data</h4><p>Here we use the function above to get dynamic HTML data from my MAL list (you can replace with any user’s MAL list. The data is saved again to a CSV file.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">'https://myanimelist.net/animelist/iasnobmatsu'</span></span><br><span class="line">driverp=<span class="string">"/Users/ziqianxu/Downloads/chromedriver"</span></span><br><span class="line">df2=getMAL(url,driverp)</span><br><span class="line">df2.to_csv(<span class="string">'iasnobmatsuMAL.csv'</span>, index=<span class="literal">False</span>)</span><br><span class="line">df2.head()</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>anime</th>
      <th>progress</th>
      <th>score</th>
      <th>type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>JoJo no Kimyou na Bouken Part 3: Stardust Crus...</td>
      <td>- / 24</td>
      <td>8</td>
      <td>TV</td>
    </tr>
    <tr>
      <th>1</th>
      <td>One Piece</td>
      <td>- / -</td>
      <td>8</td>
      <td>TV</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Shingeki no Kyojin: The Final Season</td>
      <td>- / 16</td>
      <td>10</td>
      <td>TV</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Akagami no Shirayuki-hime</td>
      <td>12</td>
      <td>5</td>
      <td>TV</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Bleach</td>
      <td>366</td>
      <td>7</td>
      <td>TV</td>
    </tr>
  </tbody>
</table>
</div>

</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/web-scraping/">web scraping</a></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2021/05/08/002-seam/"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Content-Aware Image Resizing</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">iasnobmatsu</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">6</div></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-music"></i><span>Today's Lyrics</span></div><div class="announcement_content">避开大家无聊之中勉勉强强的热闹 开发自己能够得到孤独中的欢笑 不想再去唠唠叨叨...没完没了</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Scraping-Static-HTML-Using-MAL-Top-Animes-as-An-Example"><span class="toc-number">1.</span> <span class="toc-text">Scraping Static HTML: Using MAL Top Animes as An Example</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Import-libraries"><span class="toc-number">1.1.</span> <span class="toc-text">Import libraries</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Helper-Function-to-Parse-One-Anime-Row"><span class="toc-number">1.2.</span> <span class="toc-text">Helper Function to Parse One Anime Row</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Function-to-Get-a-Specified-Number-of-Anime-on-The-Top-Anime-List"><span class="toc-number">1.3.</span> <span class="toc-text">Function to Get a Specified Number of Anime on The Top Anime List</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Convert-Data"><span class="toc-number">1.4.</span> <span class="toc-text">Convert Data</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Scraping-Dynamic-HTML-Using-MAL-user-list-as-An-Example"><span class="toc-number">2.</span> <span class="toc-text">Scraping Dynamic HTML: Using MAL user list as An Example</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Helper-Function-to-Get-One-Row-of-MAL-User-List"><span class="toc-number">2.1.</span> <span class="toc-text">Helper Function to Get One Row of MAL User List</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Additional-Libraries-for-Dynamic-HTML"><span class="toc-number">2.2.</span> <span class="toc-text">Additional Libraries for Dynamic HTML</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Get-Dynamic-MAL-User-List-Data"><span class="toc-number">2.3.</span> <span class="toc-text">Get Dynamic MAL User List Data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Convert-Data-1"><span class="toc-number">2.4.</span> <span class="toc-text">Convert Data</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/19/024/" title="以前爱听的歌现在也会觉得好听">以前爱听的歌现在也会觉得好听</a><time datetime="2022-12-21T05:00:00.000Z" title="Updated 2022-12-21 05:00:00">2022-12-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/05/022-colorpalette/" title="想做一个 JOJO 的 Color Palette">想做一个 JOJO 的 Color Palette</a><time datetime="2022-12-15T05:00:00.000Z" title="Updated 2022-12-15 05:00:00">2022-12-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/15/023/" title="想吃红烧鱼">想吃红烧鱼</a><time datetime="2022-12-15T05:00:00.000Z" title="Updated 2022-12-15 05:00:00">2022-12-15</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By iasnobmatsu</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script></div></div></body></html>